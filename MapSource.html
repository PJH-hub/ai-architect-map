<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AI Architect Map Selector</title>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-family: sans-serif;
            font-size: 12px;
        }
    </style>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=qe2kir4ks6&submodules=drawing"></script>
</head>
<body>
    <div id="info-panel">마우스로 사각형을 그리면 해당 영역의 지형 데이터를 가져옵니다.(v2)</div>
    <div id="map"></div>

    <script>
        var map;
        var drawingManager;

        function initMap() {
            // 1. 지도 먼저 생성
            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(35.85, 128.53),
                zoom: 16
            });

            // 2. [핵심] 지도가 완전히 로드(init)된 것을 확인한 후 그리기 도구 생성
            naver.maps.Event.once(map, 'init', function () {
                console.log("Map initialized. Setting up Drawing Manager...");

                drawingManager = new naver.maps.drawing.DrawingManager({
                    map: map,
                    drawingControl: [naver.maps.drawing.DrawingMode.RECTANGLE],
                    rectangleOptions: {
                        fillColor: '#2DB400',
                        fillOpacity: 0.3,
                        strokeWeight: 2,
                        strokeColor: '#2DB400'
                    }
                });

                // 사각형 그리기 완료 이벤트
                naver.maps.Event.addListener(drawingManager, 'overlayadded', function (e) {
                    var bounds = e.overlay.getBounds();
                    var result = {
                        sw: { lat: bounds.getSouthWest().lat(), lng: bounds.getSouthWest().lng() },
                        ne: { lat: bounds.getNorthEast().lat(), lng: bounds.getNorthEast().lng() }
                    };
                    if (window.chrome && window.chrome.webview) {
                        window.chrome.webview.postMessage(JSON.stringify(result));
                    }
                });
            });
        }

        // 페이지 로드 시 실행
        initMap();
    </script>
</body>
</html>