<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="origin">
    <title>AI Architect Map Selector</title>
    <style>
        /* 지도가 화면에 꽉 차도록 설정 */
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-family: sans-serif;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
    </style>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=12k3i0xzdb&submodules=drawing"></script>
</head>
<body>
    <div id="info-panel">v2.0: 마우스로 영역을 그리면 좌표를 수신합니다.</div>
    <div id="map"></div>

    <script>
        var map;
        var drawingManager;

        function initMap() {
            try {
                // 1. 지도 생성
                map = new naver.maps.Map('map', {
                    center: new naver.maps.LatLng(35.85, 128.53), // 대구
                    zoom: 16,
                    mapTypeId: naver.maps.MapTypeId.NORMAL
                });

                // 2. 그리기 도구 설정 (지도 초기화 후 실행)
                naver.maps.Event.once(map, 'init', function () {
                    console.log("지도 로드 성공");
                    drawingManager = new naver.maps.drawing.DrawingManager({
                        map: map,
                        drawingControl: [naver.maps.drawing.DrawingMode.RECTANGLE],
                        rectangleOptions: {
                            fillColor: '#2DB400', fillOpacity: 0.3,
                            strokeWeight: 2, strokeColor: '#2DB400'
                        }
                    });

                    // 사각형 완성 시 이벤트
                    naver.maps.Event.addListener(drawingManager, 'overlayadded', function (e) {
                        var bounds = e.overlay.getBounds();
                        var result = {
                            sw: { lat: bounds.getSouthWest().lat(), lng: bounds.getSouthWest().lng() },
                            ne: { lat: bounds.getNorthEast().lat(), lng: bounds.getNorthEast().lng() }
                        };
                        // 캐드로 데이터 전송
                        if (window.chrome && window.chrome.webview) {
                            window.chrome.webview.postMessage(JSON.stringify(result));
                            document.getElementById('info-panel').innerText = "✅ 좌표 전송 완료!";
                        } else {
                            console.log("좌표:", result);
                        }
                    });
                });
            } catch (err) {
                alert("지도 실행 중 에러 발생: " + err);
            }
        }

        initMap();
    </script>
</body>
</html>